

# ğŸ” FILE ENCRYPTION BEFORE UPLOAD (STAGING) â€” SOC INVESTIGATION STEPS

---

## ğŸ§  WHAT THIS ACTIVITY MEANS

File encryption before upload is a **staging technique** where data is **compressed or encrypted locally** before being transferred externally.

Attackers and insiders do this to:

* ğŸš« Bypass DLP content inspection
* ğŸ“¦ Reduce file size
* ğŸ”’ Hide sensitive content
* â˜ï¸ Upload data without triggering pattern-based detection

This behavior is **rare in normal business workflows** and is a **strong pre-exfiltration signal**.

---

## ğŸš¨ WHY THIS IS HIGH RISK

* Encrypted files cannot be inspected by DLP
* Legitimate tools (7zip, WinRAR, PowerShell) are abused
* Often followed by cloud upload, email, or USB copy
* Common in insider theft and advanced data exfiltration

If encryption + external transfer is confirmed â†’ **treat as incident until disproven**.

---

## â±ï¸ WHEN TO INVESTIGATE

* ğŸ”´ Encryption followed by upload within minutes
* ğŸ”´ Encryption during off-hours
* ğŸ”´ First-time encryption behavior by user
* ğŸ”´ Encryption of sensitive directories (Finance, HR, SourceCode)

---

## ğŸ§­ PHASE 1 â€” ALERT INTAKE & INITIAL CONTEXT

### WHERE THIS IS DETECTED

* EDR behavioral alerts
* DLP alerts showing â€œEncrypted / Uninspectable fileâ€
* CASB showing encrypted archive upload
* SIEM correlation (archive creation + upload)

---

### WHAT TO CONFIRM IMMEDIATELY

* ğŸ‘¤ User and host
* ğŸ“‚ File type created (.zip, .7z, .rar, .aes, .gpg)
* ğŸ•’ Time of encryption
* âš™ï¸ Process used
* ğŸŒ Any upload or copy event after encryption

---

### SAMPLE ALERT CONTEXT

```
Alert: Encrypted Archive Created
User: gagan@corp.com
Host: LAPTOP-21
File: finance_data.7z
Process: 7z.exe
Time: 23:18 IST
```

ğŸš© Off-hours + encryption = staging indicator

---

## ğŸ§  PHASE 2 â€” FILE & PATH ANALYSIS

### WHY THIS MATTERS

The **location and naming** of encrypted files often reveal intent.

---

### WHERE TO LOOK (WINDOWS PATHS)

Common staging locations:

```
C:\Users\<user>\AppData\Local\Temp\
C:\Users\<user>\Downloads\
C:\Users\<user>\Desktop\
C:\Users\Public\
C:\ProgramData\
```

Sensitive source paths:

```
C:\Users\<user>\Documents\Finance\
C:\Users\<user>\Documents\HR\
D:\SourceCode\
\\FileServer\Shared\
```

---

### WHAT TO CHECK

* Original file locations
* Encrypted file destination
* File naming (generic vs meaningful)
* File size before vs after encryption

---

### SAMPLE FILE EVENT (WINDOWS 4663)

```
Event ID: 4663
Object Name: C:\Users\gagan\Documents\Finance\Payroll.xlsx
Access: ReadData
Process: 7z.exe
```

ğŸš© Sensitive file read immediately before archive creation

---

## âš™ï¸ PHASE 3 â€” PROCESS & COMMAND-LINE ANALYSIS

### WHY THIS PHASE IS CRITICAL

Command lines expose **attacker intent**, not just activity.

---

### WHERE TO LOOK

* EDR process tree
* Event Viewer â†’ Security â†’ Event ID 4688

ğŸ“„ Log file:

```
C:\Windows\System32\winevt\Logs\Security.evtx
```

---

### COMMON ENCRYPTION TOOLS & COMMANDS

#### 7-Zip

```
7z.exe a finance.7z C:\Users\gagan\Documents\Finance\*
```

#### WinRAR

```
rar a -hpSecret123 data.rar C:\HR\
```

#### PowerShell

```
Compress-Archive -Path C:\Data\* -DestinationPath C:\Temp\data.zip
```

#### OpenSSL / GPG

```
gpg --encrypt payroll.xlsx
```

---

### SAMPLE PROCESS LOG

```
Event ID: 4688
Process: 7z.exe
Command Line: 7z.exe a finance.7z C:\Users\gagan\Documents\Finance\*
User: gagan
```

ğŸš© Recursive encryption of sensitive directory = strong staging signal

---

## ğŸŒ PHASE 4 â€” POST-ENCRYPTION TRANSFER VALIDATION

### WHY THIS PHASE EXISTS

Encryption alone is suspicious
Encryption **followed by transfer** confirms exfiltration intent

---

### WHERE TO LOOK

**Network**

* Proxy / SWG logs
* Firewall logs

**Cloud**

* CASB
* Cloud audit logs

**Endpoint**

* USB copy alerts

---

### SAMPLE PROXY LOG

```
User: gagan
Action: Upload
File: finance.7z
Destination: drive.google.com
Method: POST
Time: 23:21
```

ğŸš¨ Encryption â†’ upload within minutes = confirmed staging + exfil attempt

---

## ğŸ” PHASE 5 â€” TIMELINE CORRELATION

### BUILD A CLEAR SEQUENCE

```
23:15 Sensitive files accessed
23:18 Encrypted archive created
23:21 Archive uploaded externally
```

Timeline confirms **intent**, not coincidence.

---

## ğŸ§  PHASE 6 â€” USER & BEHAVIOR CONTEXT

### WHY CONTEXT DECIDES VERDICT

Encryption is rare for normal users.

Check:

* Is encryption part of userâ€™s role?
* Any prior encryption behavior?
* Resignation / offboarding signals?
* Previous DLP or exfil alerts?

ğŸš© First-time encryption + sensitive data = insider threat signal

---

## âš–ï¸ PHASE 7 â€” CLASSIFICATION LOGIC

| Condition                               | Verdict   |
| --------------------------------------- | --------- |
| Encrypted test data, no transfer        | Monitor   |
| Encryption + approved business workflow | Benign    |
| Encryption of sensitive data            | High risk |
| Encryption + external upload            | Incident  |
| Encryption + USB copy                   | Incident  |

---

## ğŸš¨ PHASE 8 â€” RESPONSE ACTIONS

### IMMEDIATE ACTIONS

* â›” Block upload / sharing
* ğŸ” Suspend user session
* ğŸ“¦ Preserve encrypted files & logs
* ğŸ§¾ Notify data owner

---

### IF CONFIRMED INCIDENT

* ğŸ”‘ Reset credentials
* ğŸ”„ Revoke active sessions
* ğŸ“£ Notify Legal / HR / Compliance
* ğŸ” Full endpoint & user investigation

---

## ğŸ§  FINAL SOC TRUTH

ğŸ” Encryption before upload is **not protection**
ğŸ“¦ It is **staging**
ğŸš« It is designed to defeat controls
ğŸ‘¤ Legitimate tools do not mean legitimate intent

> **When sensitive data is encrypted before leaving the environment,
> assume intent until evidence proves otherwise.**

